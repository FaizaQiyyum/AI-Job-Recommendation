{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Admin Dashboard{% endblock %}</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'core/css/styles.css' %}">

  <style>
    /* üåü Extra Styling for Admin Panel */
    body { background-color: #f8f9fa; font-family: 'Poppins', sans-serif; transition: background-color 0.3s, color 0.3s; }
    .navbar { box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
    .nav-link.active { font-weight: bold; text-decoration: underline; }
    .container { padding-bottom: 50px; }
    footer { background-color: #212529; color: #fff; text-align: center; padding: 15px 0; margin-top: 30px; }
    .btn-custom { background-color: #0d6efd; color: #fff; border-radius: 6px; }
    .btn-custom:hover { background-color: #0b5ed7; }
    .card { border: none; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }

    /* üåô Dark Mode */
    body.dark-mode { background-color: #121212; color: #e0e0e0; }
    body.dark-mode .navbar { background: linear-gradient(90deg, #1c1c1c, #2a2a2a); }
    body.dark-mode footer { background-color: #1c1c1c; color: #bbb; }

    /* üîî Notification & Dark Mode */
    #user-controls { display:flex; justify-content:flex-end; align-items:center; gap:8px; margin-bottom:12px; position:relative; }
    .notification-bell { position:relative; cursor:pointer; font-size:1.2rem; }
    .notification-count { position:absolute; top:-6px; right:-8px; background:#dc3545; color:#fff; border-radius:50%; padding:2px 6px; font-size:12px; font-weight:bold; }
    .notifications-dropdown { display:none; position:absolute; right:0; top:28px; width:300px; background:white; border:1px solid #ddd; box-shadow:0 4px 12px rgba(0,0,0,.15); z-index:9999; max-height:300px; overflow-y:auto; border-radius:6px; }
    .note { padding:8px 12px; border-bottom:1px solid #f1f1f1; font-size:14px; }
    .note.unread { background:#f8f9fa; font-weight:600; }
    .dropdown-footer { text-align:center; padding:6px; border-top:1px solid #eee; }
    body.dark-mode .notifications-dropdown { background:#2a2a2a; color:#e6e6e6; }
    body.dark-mode .note { border-bottom:1px solid #444; }
    body.dark-mode .dropdown-footer { border-top:1px solid #444; }
  </style>
</head>

<body>
  <!-- Admin Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold" href="{% url 'admin_dashboard' %}">Admin Panel</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link {% if request.path == '/admin-dashboard/' %}active{% endif %}" href="{% url 'admin_dashboard' %}">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == '/admin/jobs/' %}active{% endif %}" href="{% url 'admin_jobs' %}">Jobs</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == '/admin/users/' %}active{% endif %}" href="{% url 'admin_users' %}">Users</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'logout' %}" id="logoutLink">Logout</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- User Controls: Notification Bell + Dark Mode -->
  {% if user.is_authenticated %}
  <div class="container" id="user-controls">
    <div id="bellBox" class="notification-bell">
      üîî
      <span id="notifCount" class="notification-count" style="display:none;">0</span>
      <div id="notifDropdown" class="notifications-dropdown"></div>
    </div>
    <button id="darkModeBtn" class="btn btn-outline-secondary btn-sm" title="Toggle Dark Mode">üåô</button>
  </div>
  {% endif %}

  <!-- Flash Messages -->
  <div class="container">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <!-- Page Content -->
  <div class="container">
    {% block content %}{% endblock %}
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p class="mb-0">¬© {{ now|date:"Y" }} Admin Dashboard | Built with ‚ù§Ô∏è by Faiza</p>
    </div>
  </footer>

  <!-- Bootstrap Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Dark Mode & Notifications Script -->
  <script>
    // Dark Mode
    const darkModeBtn = document.getElementById('darkModeBtn');
    if(darkModeBtn){
      const currentTheme = localStorage.getItem('theme');
      if(currentTheme === 'dark'){
        document.body.classList.add('dark-mode');
        darkModeBtn.textContent = '‚òÄÔ∏è';
      }
      darkModeBtn.addEventListener('click', ()=>{
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        darkModeBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      });
    }

    // Logout Confirmation
    const logoutLink = document.getElementById('logoutLink');
    if(logoutLink){
      logoutLink.addEventListener('click', (e)=>{
        if(!confirm('Are you sure you want to log out?')) e.preventDefault();
      });
    }

    // Notifications Logic
    (function(){
      const bellBox = document.getElementById('bellBox');
      const notifCount = document.getElementById('notifCount');
      const notifDropdown = document.getElementById('notifDropdown');

      function getNotifications(){ return JSON.parse(localStorage.getItem('user_notifications') || '[]'); }
      function saveNotifications(list){ localStorage.setItem('user_notifications', JSON.stringify(list)); }

      window.addNotification = function(message){
        const notes = getNotifications();
        notes.unshift({ message, created_at: new Date().toLocaleString(), is_read: false });
        saveNotifications(notes);
        renderNotifications();
      }

      function renderNotifications(){
        const notes = getNotifications();
        notifDropdown.innerHTML = '';
        if(notes.length === 0){
          notifDropdown.innerHTML = '<div class="note">No notifications yet.</div>';
          notifCount.style.display = 'none';
          return;
        }
        let unreadCount = notes.filter(n=>!n.is_read).length;
        notifCount.style.display = unreadCount ? 'inline-block' : 'none';
        notifCount.textContent = unreadCount;

        notes.forEach(n=>{
          const div = document.createElement('div');
          div.className = 'note ' + (n.is_read ? '' : 'unread');
          div.innerHTML = `<div>${n.message}</div><small>${n.created_at}</small>`;
          div.onclick = function(){ n.is_read=true; saveNotifications(notes); renderNotifications(); };
          notifDropdown.appendChild(div);
        });

        const footer = document.createElement('div');
        footer.className = 'dropdown-footer';
        footer.innerHTML = '<button id="markAllRead" class="btn btn-sm btn-secondary">Mark all as read</button>';
        notifDropdown.appendChild(footer);
        document.getElementById('markAllRead').onclick = function(){ notes.forEach(n=>n.is_read=true); saveNotifications(notes); renderNotifications(); };
      }

      bellBox.addEventListener('click', ()=>{ notifDropdown.style.display = notifDropdown.style.display==='block' ? 'none' : 'block'; });
      document.addEventListener('click', (e)=>{ if(!bellBox.contains(e.target)) notifDropdown.style.display='none'; });
      renderNotifications();
    })();
  </script>
</body>
</html>
