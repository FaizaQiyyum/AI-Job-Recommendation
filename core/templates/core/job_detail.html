{% extends "core/base.html" %}
{% block title %}{{ job.title }} | Job Details{% endblock %}

{% block content %}
<div class="container my-5">
  <h2 class="mb-3">{{ job.title }}</h2>
  <h5 class="text-muted">{{ job.company }} — {{ job.location }}</h5>
  <hr>

  <p><strong>Description:</strong> {{ job.description }}</p>
  <p><strong>Salary:</strong> {{ job.salary }}</p>
  <p><strong>Job Type:</strong> {{ job.job_type }}</p>
  <p><strong>Experience Level:</strong> {{ job.experience_level }}</p>
  <p><strong>Employment Type:</strong> {{ job.employment_type }}</p>
  <p><strong>Remote Option:</strong> {{ job.remote_option }}</p>
  <p><strong>Skills Required:</strong> {{ job.skills_required }}</p>
  <p><strong>Deadline:</strong> {{ job.deadline|date:"M d, Y" }}</p>

  <div class="mt-3 d-flex gap-2">
    {% if user.is_authenticated and not user.is_staff %}
      {% if job.id in applied_ids %}
        <button class="btn btn-secondary" disabled>Applied</button>
      {% else %}
        <form method="post" action="{% url 'apply_job' job.id %}" style="display:inline;">
          {% csrf_token %}
          <button class="btn btn-success" type="submit">Apply</button>
        </form>
      {% endif %}

      {% if job.id in bookmarked_ids %}
        <a href="#" 
           class="btn btn-warning save-job-btn" 
           data-job="{{ job.title }}">Unsave</a>
      {% else %}
        <a href="#" 
           class="btn btn-outline-warning save-job-btn" 
           data-job="{{ job.title }}">Save</a>
      {% endif %}
    {% else %}
      <a href="{% url 'login' %}?next={% url 'job_detail' job.id %}" class="btn btn-success">Apply</a>
    {% endif %}

    <a href="{% url 'job_list' %}" class="btn btn-outline-secondary">Back to Jobs</a>
  </div>
</div>

<!-- ===============================
     Save/Unsave Job Notification JS
=================================-->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const saveButtons = document.querySelectorAll(".save-job-btn");

  saveButtons.forEach(btn => {
    btn.addEventListener("click", function(e) {
      e.preventDefault();
      const jobName = btn.getAttribute("data-job");
      const action = btn.textContent.includes("Save") ? "saved" : "unsaved";

      // Trigger global notification from base.html
      if (typeof addNotification === "function") {
        addNotification(`✅ You ${action} "${jobName}" job`);
      }

      // Toggle button text and style
      if (action === "saved") {
        btn.textContent = "Unsave";
        btn.classList.remove("btn-outline-warning");
        btn.classList.add("btn-warning");
      } else {
        btn.textContent = "Save";
        btn.classList.remove("btn-warning");
        btn.classList.add("btn-outline-warning");
      }
    });
  });
});
</script>
{% endblock %}
